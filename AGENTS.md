# Gemini Project Context: DocFX Documentation

## Project Overview
This project is a documentation site generator for the Unity game *Lobotomy Corporation* (inferred from code symbols like `BinahBoss`, `CreatureGenerate`). It utilizes **DocFX** to generate API references directly from the game's assemblies (DLLs) and includes a custom toolchain to convert this metadata into **Wiki.js** compatible Markdown.

## Directory Structure
- **`assemblies/`**: Contains the managed assemblies (DLLs) of the game, including `Assembly-CSharp.dll` (main game logic) and Unity engine libraries. These are the source of truth for the API documentation.
- **`api/`**: Contains YAML metadata files generated by DocFX from the assemblies in `assemblies/`. These files represent the structure of the classes, methods, and properties.
- **`src/`**: Contains the source code for the conversion toolchain, specifically the logic for transforming DocFX-generated YAML metadata into Wiki.js-compatible Markdown.
- **`_site/`**: The output directory containing the generated static HTML website (standard DocFX output).
- **`wikijs_out/`**: (Generated) The output directory containing the Markdown files ready for Wiki.js.
- **`docfx.json`**: The main configuration file for DocFX, defining input sources (`assemblies/`), output destinations (`api/`, `_site`), and templates.
- **`main.py`**: The orchestration script that runs `docfx metadata` followed by the Wiki.js conversion script.
- **`pyproject.toml`**: Python project configuration using `uv` for dependency management, including tools like `mypy` and `ruff`.

## Building and Running

### Prerequisites
- **DocFX**: Required to generate metadata (`dotnet docfx`).
- **Python 3.12+**: Required for the Python tooling.
- **uv**: Recommended for managing Python dependencies.
- **ripgrep**: Available via the `rg` command for fast searching.

### Key Commands

#### Full Build (Metadata + Conversion)
To regenerate the DocFX metadata and convert it to Wiki.js format in one go:
```bash
uv run python main.py
```

#### Development Cycle (Recommended)
To run the full development pipeline (Linting -> Type Checking -> Build):
```bash
uv run python dev.py
```

To run only the verification steps (Linting -> Type Checking -> Tests) without the build:
```bash
uv run python dev.py --ci
```

#### Continuous Integration
The project uses GitHub Actions for CI. The workflow is defined in `.github/workflows/ci-gate.yml` and performs the following checks on Pull Requests:
1.  **Setup**: Installs Python 3.12 and `uv`.
2.  **Dependencies**: Installs dependencies using `uv sync --frozen`.
3.  **Verification**: Runs `uv run python dev.py --ci`.
4.  **Artifacts**: Uploads coverage reports.

#### Documentation Build (Standard DocFX)
To only build the standard DocFX static site:
```bash
# Generate metadata and build the site
docfx docfx.json
# Or serve locally
docfx docfx.json --serve
```

#### Wiki.js Conversion (Manual)
To run the conversion script manually (assuming metadata in `api/` exists):
```bash
uv run python src/docfx_yml_to_wikijs.py api wikijs_out --include-namespace-pages --include-member-details --home-page
```

#### Python Environment
To set up and run the Python environment:
```bash
# Install dependencies
uv sync

# Run the development script (wraps ruff, mypy, and main.py)
uv run python dev.py
```

## Conventions
- **API Generation**: The project relies on `assemblies/Assembly-CSharp.dll` as the primary source for API documentation. Avoid manually editing generated files in `api/` unless you are sure they won't be overwritten.
- **Conversion Logic**: Modifications to the Wiki.js output format should be made in `src/docfx_yml_to_wikijs.py`.
- **Output Naming**: Generated Markdown files use hyphens instead of periods for namespaces and types (e.g., `My-Namespace-Class.md`) to ensure compatibility with Wiki.js, which restricts special characters in page paths.
- **Markdown**: General documentation is written in standard Markdown (e.g., `index.md`).
- **Python Style**: Adhere to `ruff` and `mypy` standards for any Python scripts added to the project.
- **Imports (E402)**: Imports must be at the top of the file, after module comments/docstrings. Exception: `sys.path` and `os.environ` modifications are allowed between imports.
- **Top-Level Imports (PLC0415)**: Avoid `import` statements outside of a module's top-level scope (e.g., inside functions). Place them at the top of the file to clarify dependencies and avoid hidden side effects, unless necessary for avoiding circular dependencies or deferred loading.
